<apex:page controller="SearchController" >

<!-- include jquery API to create a dynamic table with dynamic columns and CSS similar to salesfroce -->
    <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"/> 
    <apex:includeScript value="http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"/> 
    
    
   <apex:pageBlock >
           
     <apex:pageBlockSection columns="1" title="Select Object" collapsible="false" id="selectPanel" >
   <apex:outputpanel >
                    <apex:Outputlabel >Select Object</apex:Outputlabel>&nbsp;
                    <select size="1" id="Objectdropdown">
                       <option value="Account">Account</option>
                       <option value="Contact">Contact</option>
                   </select> 
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <button type="button" onclick="openCreatePage()">Add New Record</button> 
                </apex:outputPanel>
       </apex:pageBlockSection>
            <apex:pageBlockSection columns="1" title="Search Section" collapsible="false" id="searchPanel" >
                <apex:outputpanel >
                
     <apex:outputLabel >Enter</apex:outputLabel>&nbsp;
     <input type="text" id="searchBox" />

                &nbsp;&nbsp;&nbsp;
               <button type="button" onclick="getRemoteCall()">Search</button> 
                 </apex:outputPanel>
                
            </apex:pageBlockSection>
           
            <apex:pageBlockSection columns="1" title="Search Results" collapsible="false" id="resultPanel"  >
      <!--- dynamic table --->
            <table cellspacing="0" cellpadding="0" border="0" id="searchResults" class="list "> 
                <colgroup span="2"></colgroup>      
                <thead>
                <tr id="tblOrderReportHeaderRow"  class="headerRow ">
                </tr>
            </thead>
     
            <tbody />   
          </table> 
            <br/>
         <button type="button" onclick="getCall('previous')">Previous</button>   &nbsp;&nbsp;&nbsp;&nbsp;
          <button type="button" onclick="getCall('next')">Next</button>  &nbsp;&nbsp;&nbsp;&nbsp;
          
          </apex:pageBlockSection>
          
     </apex:pageBlock>
     
<!-- dynamic column mapping with javascript SObject fields -->
     <script id="accountTableRowTemplate" type="text/x-jquery-tmpl"> 
    <tr onfocus="if (window.hiOn){hiOn(this);}" onblur="if (window.hiOff){hiOff(this);}" onmouseout="if (window.hiOff){hiOff(this);} " onmouseover="if (window.hiOn){hiOn(this);} " class="dataRow even  first">   
        <td class="dataCell">${Name}</td>  
        <td class="dataCell">${Rating}</td>   
        <td class="dataCell">${Website}</td> 
        <td class="dataCell">${Phone}</td>     
        <td class="dataCell">${Fax}</td>
    </tr>          
    </script> 
    
    <script id="contactTableRowTemplate" type="text/x-jquery-tmpl"> 
    <tr onfocus="if (window.hiOn){hiOn(this);}" onblur="if (window.hiOff){hiOff(this);}" onmouseout="if (window.hiOff){hiOff(this);} " onmouseover="if (window.hiOn){hiOn(this);} " class="dataRow even  first">   
        <td class="dataCell">${FirstName}</td>  
        <td class="dataCell">${LastName}</td>   
        <td class="dataCell">${Email}</td> 
        <td class="dataCell">${Fax}</td>     
        <td class="dataCell">${Phone}</td>
    </tr>          
    </script> 
    
    
   
 <script type="text/javascript">
 var objectValue;
 var pageNumber =0;
 var searchValue;

 function openCreatePage(){
 objectValue = $('#Objectdropdown').val();
  if(objectValue=='Account'){
  window.open('https://ap1.salesforce.com/001/e')
  }else{
  window.open('https://ap1.salesforce.com/003/e')
  }
 }
 
//Method calls from search button to call server method   
 function getRemoteCall() {
        
        var markup = "";
        var arrTableHeader = [];
  pageNumber=0;
        //var searchValue = document.getElementsByName('searchBox')[0].value;
         searchValue = $('#searchBox').val(); 
        
        //var objectValue = document.getElementsByName('Objectdropdown')[0].value;
         objectValue = $('#Objectdropdown').val();
        
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.SearchController.RemoteCall}', 
            searchValue,objectValue , 
            function(result, event){
            if (event.status && event.result) {
            
    pageNumber=1;
             var spltArray = event.result.fieldList.split(',');
      for (var i = 0; i <= spltArray.length; i++) {

     arrTableHeader.push(createHeader(spltArray[i]));
    }

    markup += createHeaderMarkup(); 
    $.template("tblHeaderTemplate", markup);
    $("#tblOrderReportHeaderRow").empty();

   //dynamic header creation

    $.tmpl("tblHeaderTemplate", arrTableHeader).appendTo("#tblOrderReportHeaderRow");

    refreshData(event.result.rowList);
                         
                             
                } else if (event.type === 'exception') {
                    document.getElementById("responseErrors").innerHTML = event.message;
                } else {
                    document.getElementById("responseErrors").innerHTML = event.message;
                }
            }, 
            {escape: true}
        );
       
    }
     
//append data to search table via jquery tamplates 
    function refreshData(data){
      
            $("#searchResults tbody").html(''); 
            
            $.each(data, function () {         
                        
                       if(objectValue=='Account'){
                        $("#accountTableRowTemplate" ).tmpl(this).appendTo( "#searchResults tbody" );  
                        }else{
                         $("#contactTableRowTemplate" ).tmpl(this).appendTo( "#searchResults tbody" );  
                        }
                                                      
                        }  
                 );
      }
      
        
//Methods for paginations
 function getCall(buttonType){
        
  if(buttonType=='next' ){
             pageNumber =  pageNumber +1 ;
        }
        else if(buttonType=='previous' ){
    if( pageNumber >=2){
    pageNumber =  pageNumber -1 ;
   }
        }
        

         Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.SearchController.RemoteCallPagaination}', 
            searchValue,objectValue,buttonType,pageNumber, 
            function(result, event){
            if (event.status && event.result) {
                refreshData(event.result);
            } else if (event.type === 'exception') {
                    document.getElementById("responseErrors").innerHTML = event.message;
                } else {
                    document.getElementById("responseErrors").innerHTML = event.message;
                }
            }, 
            {escape: true}
        );
     
    }
        
     function createHeaderMarkup() {
            return ("<th >${colName}</th>");
        }
        function createHeader(colName) {
            return ({ 'colName': colName });
        }
    
     </script>
  
 </apex:page>