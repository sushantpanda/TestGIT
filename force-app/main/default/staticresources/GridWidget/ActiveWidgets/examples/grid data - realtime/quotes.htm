<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	<title>ActiveWidgets Examples</title>

<!-- fix box model in firefox/safari/opera -->
<style type="text/css">
	.aw-quirks * {
		box-sizing: border-box;
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
	}

	body {font: 12px Tahoma}
</style>

<!-- include links to the script and stylesheet files -->
	<script src="../../runtime/lib/aw.js" type="text/javascript"></script>
	<link href="../../runtime/styles/system/aw.css" rel="stylesheet">

<!-- change default styles, set control size and position -->
<style type="text/css">

	#myGrid {height: 200px; width: 700px}

</style>
</head>
<body>
	<h3>Realtime updates</h3>
	<p>Simulation of 'realtime' data updates using pre-recorded CSV files in a loop</p>

<!-- insert control tag -->
	<span id="myGrid"></span>

	<p>Back to <a href="../index.htm">all examples list</a></p>
	<p>See also <a href="http://www.activewidgets.com/javascript.forum.18129.8/ok-i-am-a-complete.html">this forum topic</a></p>

<!-- create controls -->
<script type="text/javascript">

	var grid = new AW.UI.Grid;
	grid.setId("myGrid");
	grid.setHeaderText(["Ticker", "Last", "Time", "Change", "Open", "High", "Low", "Volume"]);
	grid.setColumnIndices([0,1,3,4,5,6,7]);
	grid.setColumnCount(7);
	grid.refresh();

</script>


<script type="text/javascript">
	var table = new AW.CSV.Table;
	table.response1 = table.response;
	table.response = function(text){
		this.response1(text);
		var rowCount = this.getCount();
		if (rowCount != grid.getRowCount()) {
			grid.setRowCount(rowCount);
			grid.refresh();
		}

		var columns = grid.getColumnIndices();
		for (var r=0; r<rowCount;r++){
			for (var i=0; i<columns.length;i++){
				var c = columns[i];
				var v = this.getData(c, r);
				if (v != grid.getCellText(c, r)){
					grid.setCellText(v, c, r);
					highlight(c, r);
				}
			}
		}

		function highlight(c, r){
			var e = grid.getCellTemplate(c, r).element();
			if (e) {
				e.style.color = "red";
				window.setTimeout(function(){
					e.style.color = "black";
					e = null;
				}, 1000);
			}
		}

		window.setTimeout(function(){
			n = (++n)%5;
			table.setURL("quotes" + (n+1) + ".csv");
			table.request();
		}, 2000);
	}

	var n = 0;
	table.setURL("quotes1.csv");
	table.request();

</script>
</body>
</html>